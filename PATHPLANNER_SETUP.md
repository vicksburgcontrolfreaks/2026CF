# PathPlanner Setup Guide

## Overview

PathPlanner is now integrated into your robot code! This guide will help you set up and use PathPlanner for autonomous routines.

## What's Already Done

✅ **PathPlanner AutoBuilder configured** in [RobotContainer.java](src/main/java/frc/robot/RobotContainer.java)
✅ **Deploy folders created** at `src/main/deploy/pathplanner/`
✅ **Example autonomous commands** created for testing
✅ **Named commands registered** for use in PathPlanner GUI
✅ **Autonomous chooser** configured with both PathPlanner and custom autos

## Quick Start

### 1. Install PathPlanner GUI

1. Download PathPlanner from: https://pathplanner.dev/
2. Install and launch the application
3. Open your project: `File → Open Project` → Navigate to `c:\Code Projects\2026CF`

### 2. Configure Your Robot in PathPlanner GUI

**Important:** You MUST configure your robot settings in PathPlanner before paths will work!

1. In PathPlanner GUI, go to `Settings` (gear icon)
2. Under **Robot Config**, configure:
   - **Mass**: ~50 kg (adjust based on your actual robot)
   - **MOI (Moment of Inertia)**: ~6.0 kg·m² (adjust based on your robot)
   - **Wheel Base**: 22 inches (0.5588 m) - **MEASURE YOUR ACTUAL ROBOT**
   - **Track Width**: 22 inches (0.5588 m) - **MEASURE YOUR ACTUAL ROBOT**
   - **Wheel Radius**: 1.5 inches (0.0381 m) - for 3" diameter wheels
   - **Max Module Speed**: 3.0 m/s (adjust based on testing)
   - **Max Drive Acceleration**: 3.0 m/s²
   - **Max Angular Velocity**: 540 deg/s
   - **Max Angular Acceleration**: 720 deg/s²

3. **Save the configuration** - this creates `pplib_commands.json` in your deploy folder

### 3. Using the Autonomous Chooser

Your robot now uses PathPlanner's autonomous chooser, accessible via **Elastic dashboard**:

#### PathPlanner Autos (Available Now)
All `.auto` files from `deploy/pathplanner/autos/` appear in the chooser:
- **ExampleAuto** - Follows ExamplePath with named commands
- **TestAuto** - Simple wait command test
- Any other `.auto` files you create in PathPlanner GUI

**Note**: The previous custom autonomous commands (DriveForwardCommand, SimpleAutoCommand) have been removed. All autonomous routines now use PathPlanner for consistency and better path following.

### 4. Creating Paths in PathPlanner GUI

1. **Create a new path**: Click the `+` button in the Paths panel
2. **Add waypoints**: Click on the field to place waypoints
3. **Adjust path**:
   - Drag waypoints to move them
   - Drag control points (blue circles) to adjust curves
   - Set rotation targets for specific headings along the path
4. **Add event markers** (optional):
   - Click "Add Event Marker"
   - Position it along the path
   - Add named commands (see below)
5. **Save** - Paths auto-save to `src/main/deploy/pathplanner/paths/`

### 5. Creating Autos in PathPlanner GUI

1. **Create a new auto**: Click the `+` button in the Autos panel
2. **Set starting pose**: Click on field to set robot's starting position
3. **Add commands**:
   - Drag paths from the paths panel
   - Add named commands
   - Add wait commands
   - Organize in sequential/parallel groups
4. **Save** - Autos auto-save to `src/main/deploy/pathplanner/autos/`

## Named Commands

The following named commands are registered and can be used in PathPlanner GUI event markers:

| Command Name | Description |
|-------------|-------------|
| `stopDrive` | Stops all swerve modules |
| `lockWheels` | Locks wheels in X formation for 1 second (defense) |

### Adding More Named Commands

Edit [RobotContainer.java:92-93](src/main/java/frc/robot/RobotContainer.java#L92-L93):

```java
// Register named commands for PathPlanner
NamedCommands.registerCommand("yourCommandName", yourCommand);
```

Example - adding an intake command:
```java
NamedCommands.registerCommand("startIntake", m_intake.run(() -> m_intake.intake()));
NamedCommands.registerCommand("stopIntake", m_intake.runOnce(() -> m_intake.stop()));
```

## File Structure

```
src/main/deploy/pathplanner/
├── paths/              # Individual path files (.path)
│   └── ExamplePath.path
├── autos/              # Autonomous routines (.auto)
│   ├── ExampleAuto.auto
│   └── TestAuto.auto
└── pplib_commands.json # Generated by PathPlanner GUI (robot config)
```

## Testing Autonomous

### In Simulation
1. Run robot code in simulation mode
2. Open Driver Station
3. Open **Elastic dashboard** (recommended) or Glass
4. Select autonomous mode
5. Choose an auto from the "Auto Chooser" widget
6. Enable autonomous

### On Real Robot
1. Deploy code to robot
2. Open **Elastic dashboard** at `http://roboRIO-TEAM-frc.local:5800` (replace TEAM with your team number)
3. Select autonomous from the "Auto Chooser" dropdown
4. Enable in autonomous mode

**Pro Tip**: Elastic is the modern replacement for SmartDashboard/Shuffleboard!
- Better performance and modern UI
- Built-in field visualization
- All telemetry data from SwerveDrive and Vision subsystems available
- Auto chooser automatically appears when robot code runs

## Tuning Autonomous

If paths don't follow correctly, tune these PID constants in [Constants.java:199-205](src/main/java/frc/robot/Constants.java#L199-L205):

```java
// PathPlanner PID constants
public static final double kPTranslation = 5.0;  // Translation P gain
public static final double kPRotation = 5.0;     // Rotation P gain
```

**How to tune:**
1. Start with current values (5.0)
2. If robot oscillates: Decrease P
3. If robot is slow to reach target: Increase P
4. If robot overshoots: Add D gain (currently 0)

## Example Workflow

1. **Design path in PathPlanner GUI**
   - Create waypoints for robot movement
   - Set rotation targets
   - Add event markers for actions

2. **Create auto routine**
   - Combine multiple paths
   - Add named commands between paths
   - Set starting position

3. **Deploy to robot**
   - Build and deploy code
   - PathPlanner files deploy automatically

4. **Test and tune**
   - Run autonomous
   - Watch in Glass/SmartDashboard
   - Adjust PID values if needed

## Troubleshooting

### "Failed to load PathPlanner RobotConfig"
**Solution**: Open PathPlanner GUI and configure your robot settings. Click "Save" to generate the config file.

### Paths don't show in Auto Chooser
**Solution**:
- Make sure `.auto` files exist in `src/main/deploy/pathplanner/autos/`
- Rebuild and redeploy code
- Check console for errors

### Robot doesn't follow path correctly
**Solutions**:
1. Verify robot dimensions in PathPlanner GUI match actual robot
2. Tune translation/rotation PID constants
3. Check that odometry is working (watch pose in Glass)
4. Ensure vision pose estimation is helping correct drift

### Paths are mirrored or backwards
**Solution**: Check alliance color flipping in [RobotContainer.java:78](src/main/java/frc/robot/RobotContainer.java#L78):
```java
() -> false, // Change to true to flip for red alliance
```

## Next Steps

1. ✅ Install PathPlanner GUI
2. ✅ Configure your robot settings
3. ✅ Create your first path
4. ✅ Create your first auto routine
5. ✅ Test in simulation
6. ✅ Deploy and test on robot
7. ✅ Tune PID values
8. ✅ Create competition autonomous routines

## Resources

- **PathPlanner Documentation**: https://pathplanner.dev/home.html
- **PathPlanner GitHub**: https://github.com/mjansen4857/pathplanner
- **WPILib PathPlanner Guide**: https://docs.wpilib.org/en/stable/docs/software/pathplanning/pathplanner/index.html
- **Field Images (2025 Reefscape)**: Available in PathPlanner GUI

## Code References

- **AutoBuilder Configuration**: [RobotContainer.java:63-96](src/main/java/frc/robot/RobotContainer.java#L63-L96)
- **Named Commands**: [RobotContainer.java:92-93](src/main/java/frc/robot/RobotContainer.java#L92-L93)
- **Auto Chooser**: [RobotContainer.java:55-63](src/main/java/frc/robot/RobotContainer.java#L55-L63)
- **PID Constants**: [Constants.java:199-205](src/main/java/frc/robot/Constants.java#L199-L205)
